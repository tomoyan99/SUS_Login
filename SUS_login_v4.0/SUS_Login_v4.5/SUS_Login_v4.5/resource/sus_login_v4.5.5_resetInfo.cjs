(()=>{"use strict";const s=require("readline");process.stdin.setEncoding("utf8");const e="\b[0K",t=require("fs"),o=s=>new Promise((e=>setTimeout(e,s)));function r(){console.log("何かキーを押して終了します"),process.stdin.setRawMode(!0),process.stdin.resume(),process.stdin.on("data",process.exit.bind(process,0))}(async()=>{console.clear(),console.log("Reset.exe v2.0"),console.log("Reset.exeはパスワード入力などをミスしたときにinfo.jsonを初期化できるプログラムです");if(1===await async function t(){const o=await async function(t,o=!1){if(!1===o){const e=(0,s.createInterface)({input:process.stdin,output:process.stdout});return new Promise((s=>{e.question(t,(t=>{e.close(),s(t)}))}))}if(!0===o){let s="";process.stdout.write(t);let o="";for(;;){if(s=await new Promise((s=>{const e=process.stdin,t=e.isRaw,o=(r="")=>{if(e.off("data",o),e.pause(),e.setRawMode(t),27===r.charCodeAt(0))s("");else{for(const s of r)process.stdout.write("*");s(r)}};e.setRawMode(!0),e.resume(),e.on("data",o)})),s.charCodeAt(0)-31<=0&&13!==s.charCodeAt(0)&&8!==s.charCodeAt(0)&&3!==s.charCodeAt(0)&&process.stdout.write(e),"\r"===s)return process.stdout.write(e),console.log(),o;""===s&&(process.stdout.write(e),process.exit(-1)),"\b"!==s?"\t"!==s?o+=s:s="":""!==o?(process.stdout.write("\b\b[0K"),o=o.slice(0,o.length-1)):process.stdout.write(e)}}}("初期化しますか？[Y/N]\n");switch(!0){case/[Yy]/.test(o):return console.log("resource/data/info.jsonを初期化します"),0;case/[Nn]/.test(o):return console.log("resource/data/info.jsonは初期化しません"),1;default:return console.log("Yy/Nnで入力してください"),await t(),0}}())r();else{process.stdout.write("resource/data/info.jsonを初期化しています");for(let s=0;s<4;++s)await o(500),process.stdout.write("・");"done"===await async function(s){const e={username:"",password:"",sclass:{url:"https://s-class.admin.sus.ac.jp/up/faces/login/Com00504A.jsp",target:{name:".inputText",pass:".inputSecret",submit:"input[type=image]"}},sola:{url:"https://sola.sus.ac.jp/",target:{name:"#identifier",pass:"#password",submit:"button[type=submit]"}},last_upd:""};try{return(0,t.writeFileSync)("resource/data/info.json",JSON.stringify(e)),"done"}catch(s){throw"fault"}}()?console.log("\nresource/data/info.jsonの初期化が完了しました"):console.log("\nresource/data/info.jsonの初期化に失敗しました"),r()}})()})();